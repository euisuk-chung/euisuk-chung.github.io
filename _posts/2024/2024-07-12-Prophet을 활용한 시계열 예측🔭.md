---
title: "Prophetì„ í™œìš©í•œ ì‹œê³„ì—´ ì˜ˆì¸¡ğŸ”­"
date: "2024-07-12"
tags:
  - "Timeseries"
  - "ë¨¸ì‹ ëŸ¬ë‹"
year: "2024"
---

# Prophetì„ í™œìš©í•œ ì‹œê³„ì—´ ì˜ˆì¸¡ğŸ”­

ì›ë³¸ ê²Œì‹œê¸€: https://velog.io/@euisuk-chung/Prophetì„-í™œìš©í•œ-ì‹œê³„ì—´-ì˜ˆì¸¡



Prophet ì†Œê°œ
==========

**Facebook Prophet**ì€ ì‹œê³„ì—´ ë°ì´í„°ì˜ ì˜ˆì¸¡ì„ ìœ„í•´ Facebookì—ì„œ ê°œë°œí•œ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. Prophetì€ ìë™í™”ëœ ì´ìƒ íƒì§€ ë° ê³„ì ˆì„± ë¶„ì„ì„ ì§€ì›í•˜ë©°, íŠ¹íˆ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì¸¡(ì˜ˆ: ë§¤ì¶œ, ì‚¬ìš©ì ìˆ˜, ì›¹ íŠ¸ë˜í”½ ë“±)ì— ìœ ìš©í•©ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/euisuk-chung/post/c6905074-668a-4772-bcfc-55df0eda8761/image.png)

* `ë§í¬`: <https://facebook.github.io/prophet/>

Prophetì˜ ì¥ì 
-----------

Meta(Facebook)ì—ì„œëŠ” Prophetì˜ ì¥ì ì„ ë‹¤ìŒê³¼ ê°™ì´ ì†Œê°œí•©ë‹ˆë‹¤:  

![](https://velog.velcdn.com/images/euisuk-chung/post/f19559a6-d51e-455a-a280-16920bce3834/image.png)

> **1. ì •í™•í•˜ê³  ë¹ ë¥´ë‹¤ (Accurate and Fast)**
> 
> * **ì •í™•ì„±**: Prophetì€ Facebook ë‚´ë¶€ì˜ ë‹¤ì–‘í•œ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì˜ˆì¸¡ì„ ì œê³µí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³„íš ìˆ˜ë¦½ ë° ëª©í‘œ ì„¤ì •ì— í° ë„ì›€ì„ ì¤ë‹ˆë‹¤.
> * **ì†ë„**: ëŒ€ë¶€ë¶„ì˜ ê²½ìš°, ë‹¤ë¥¸ ì ‘ê·¼ ë°©ì‹ë³´ë‹¤ ë” ë‚˜ì€ ì„±ëŠ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. Stanì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ì„ í”¼íŒ…í•˜ë¯€ë¡œ, ëª‡ ì´ˆ ë§Œì— ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> **2. ì™„ì „ ìë™í™” (Fully Automatic)**
> 
> * **ìë™ ì˜ˆì¸¡**: ë°ì´í„°ê°€ ì–´ì§€ëŸ½ê³  ë³µì¡í•´ë„ ë³„ë‹¤ë¥¸ ìˆ˜ì‘ì—… ì—†ì´ í•©ë¦¬ì ì¸ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> * **ê°•ê±´ì„±**: ì´ìƒì¹˜, ê²°ì¸¡ì¹˜, ì‹œê°„ ì‹œê³„ì—´ì˜ ê·¹ì ì¸ ë³€í™”ì— ëŒ€í•´ ê°•ê±´í•œ ì„±ëŠ¥ì„ ë³´ì…ë‹ˆë‹¤.

> **3. ì¡°ì • ê°€ëŠ¥í•œ ì˜ˆì¸¡ (Tunable Forecasts)**
> 
> * **ì‚¬ìš©ì ì¡°ì • ê°€ëŠ¥ì„±**: ì‚¬ìš©ìê°€ ì˜ˆì¸¡ì„ ë¯¸ì„¸ ì¡°ì •í•˜ê³  ì¡°ì •í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ê°€ëŠ¥ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.
> * **í•´ì„ ê°€ëŠ¥í•œ ë§¤ê°œë³€ìˆ˜**: ì¸ê°„ì´ í•´ì„ ê°€ëŠ¥í•œ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë„ë©”ì¸ ì§€ì‹ì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ì˜ˆì¸¡ì„ ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> **4. R ë˜ëŠ” Pythonì—ì„œ ì‚¬ìš© ê°€ëŠ¥ (Available in R or Python)**
> 
> * **ì–¸ì–´ ì§€ì›**: Prophetì€ Rê³¼ Pythonì—ì„œ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ë™ì¼í•œ Stan ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
> * **ìœ ì—°ì„±**: ì‚¬ìš©ìê°€ í¸ì•ˆí•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì–¸ì–´ë¥¼ ì„ íƒí•˜ì—¬ ì˜ˆì¸¡ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ìš” ê¸°ëŠ¥
-----

1. **ì¶”ì„¸ ë³€ë™**: ì„ í˜• ë° ë¹„ì„ í˜• ì¶”ì„¸ ëª¨ë¸ë§ ì§€ì›.  
   
   Prophetì€ ë°ì´í„°ì˜ `ì¥ê¸°ì ì¸ ì¶”ì„¸ë¥¼ ëª¨ë¸ë§`í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`Prophet`ì€ ìë™ìœ¼ë¡œ ìµœì ì˜ ì¶”ì„¸ ëª¨ë¸ì„ ì„ íƒí•˜ê±°ë‚˜, ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Prophetì—ì„œëŠ” ë‘ ê°€ì§€ ì£¼ìš” ì¶”ì„¸ ëª¨ë¸ì„ ì§€ì›í•©ë‹ˆë‹¤:
   
   * **ì„ í˜• ì¶”ì„¸ (Linear Trend)**: ë°ì´í„°ê°€ ì¼ì •í•œ ì†ë„ë¡œ ì¦ê°€í•˜ê±°ë‚˜ ê°ì†Œí•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
   * **ë¹„ì„ í˜• ì¶”ì„¸ (Non-linear Trend)**: ë°ì´í„°ì˜ ë³€í™” ì†ë„ê°€ ì‹œê°„ì— ë”°ë¼ ë³€í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¡œê·¸ ë³€í™˜ ì¶”ì„¸ ë“±ì´ ìˆìŠµë‹ˆë‹¤.
     
     ```
     # ê¸°ë³¸ ì„¤ì •ì—ì„œëŠ” ì„ í˜• ì¶”ì„¸ ëª¨ë¸ì„ ì‚¬ìš©
     model = Prophet()  # ì´ëŠ” model = Prophet(growth='linear')ì™€ ë™ì¼
     
     # ì„ íƒí•´ì„œ ì‚¬ìš©ê°€ëŠ¥
     model = Prophet(growth='linear')  # ì„ í˜• ì¶”ì„¸ ëª¨ë¸
     model = Prophet(growth='logistic')  # ë¹„ì„ í˜• ì¶”ì„¸ ëª¨ë¸
     ```
2. **ê³„ì ˆì„±**: ì£¼ê¸°ì  ë³€ë™(ì¼, ì£¼, ë…„ ë‹¨ìœ„)ì„ ëª¨ë¸ë§.  
   
   Prophetì€ `ë°ì´í„°ì˜ ì£¼ê¸°ì ì¸ ë³€ë™`ì„ ëª¨ë¸ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì£¼ê°„, ì›”ê°„, ì—°ê°„ ë“±ì˜ ì£¼ê¸°ë¡œ ë°œìƒí•˜ëŠ” ë³€ë™ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. Prophetì€ ê¸°ë³¸ì ìœ¼ë¡œ ì—°ê°„ ê³„ì ˆì„±(yearly\_seasonality)ê³¼ ì£¼ê°„ ê³„ì ˆì„±(weekly\_seasonality)ì„ í¬í•¨í•˜ë©°, ì´ëŠ” í•„ìš”ì— ë”°ë¼ ì¼œê³  ëŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ë¡œ, ì‚¬ìš©ì ì •ì˜ ê³„ì ˆì„±ì„ ë„ë©”ì¸ ì§€ì‹ì„ ê¸°ë°˜ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   
   **ê¸°ë³¸ ê³„ì ˆì„±**

* ì—°ê°„ ê³„ì ˆì„± (yearly\_seasonality): ë°ì´í„°ì˜ ì—°ê°„ ì£¼ê¸°ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.
* ì£¼ê°„ ê³„ì ˆì„± (weekly\_seasonality): ë°ì´í„°ì˜ ì£¼ê°„ ì£¼ê¸°ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.
  
  ```
  # ê¸°ë³¸ ì—°ê°„ ê³„ì ˆì„±ì„ í™œì„±í™”
  model = Prophet(yearly_seasonality=True)
  
  # ê¸°ë³¸ ì£¼ê°„ ê³„ì ˆì„±ì„ í™œì„±í™”
  model = Prophet(weekly_seasonality=True)
  
  # ì—°ê°„ ê³„ì ˆì„±ì„ ë¹„í™œì„±í™”
  model = Prophet(yearly_seasonality=False)
  
  # ì£¼ê°„ ê³„ì ˆì„±ì„ ë¹„í™œì„±í™”
  model = Prophet(weekly_seasonality=False)
  
  # ì‚¬ìš©ì ì •ì˜ ê³„ì ˆì„± ì¶”ê°€
  model.add_seasonality(name='monthly', period=30.5, fourier_order=5)
  ```

3. **íœ´ì¼ íš¨ê³¼**: ê³µíœ´ì¼ ë° íŠ¹ë³„ ì´ë²¤íŠ¸ì— ëŒ€í•œ íš¨ê³¼ë¥¼ ë°˜ì˜.  
   
   Prophetì€ `ê³µíœ´ì¼ ë° íŠ¹ë³„ ì´ë²¤íŠ¸ê°€ ì‹œê³„ì—´ ë°ì´í„°ì— ë¯¸ì¹˜ëŠ” ì˜í–¥`ì„ ë°˜ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ê³µíœ´ì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ì—¬ ëª¨ë¸ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   
   ```
   from prophet.make_holidays import make_holidays_df
   
   # ê³µíœ´ì¼ ë¦¬ìŠ¤íŠ¸ ìƒì„±
   holidays = make_holidays_df(year_list=[2015, 2016, 2017, 2018, 2019], country='US')
   
   # ëª¨ë¸ ì´ˆê¸°í™” ì‹œ ê³µíœ´ì¼ ì¶”ê°€
   model = Prophet(holidays=holidays)
   ```
4. **ê²°ì¸¡ì¹˜ ì²˜ë¦¬**: ìë™ìœ¼ë¡œ ê²°ì¸¡ì¹˜ë¥¼ ì²˜ë¦¬í•˜ê³  ë¶ˆê·œì¹™í•œ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŒ.
   
   Prophetì€ `ê²°ì¸¡ì¹˜ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬`í•  ìˆ˜ ìˆìœ¼ë©°, ë¶ˆê·œì¹™í•œ ì‹œê³„ì—´ ë°ì´í„°ì—ì„œë„ ì˜ ì‘ë™í•©ë‹ˆë‹¤. ê²°ì¸¡ì¹˜ë¥¼ ë³„ë„ë¡œ ì²˜ë¦¬í•  í•„ìš” ì—†ì´ Prophet ëª¨ë¸ì— ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.

5. **ì´ìƒì¹˜ ì²˜ë¦¬**: ì´ìƒì¹˜ì— ê°•ê±´í•œ ëª¨ë¸ë§.  
   
   Prophetì€ `ì´ìƒì¹˜ì— ê°•ê±´í•œ ëª¨ë¸ë§ì„ ì œê³µ`í•©ë‹ˆë‹¤. ì´ìƒì¹˜ê°€ ìˆëŠ” ë°ì´í„°ì—ì„œë„ ëª¨ë¸ì€ ê°•ê±´í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤. ì¶”ê°€ì ìœ¼ë¡œ ì œê±°ê°€ í•„ìš”í•˜ë©´, ì‚¬ìš©ìëŠ” ì´ìƒì¹˜ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   
   ```
   # ì´ìƒì¹˜ê°€ í¬í•¨ëœ ë°ì´í„°
   train_data.loc[train_data['ds'] == '2017-07-01', 'y'] = None  # íŠ¹ì • ë‚ ì§œì˜ ì´ìƒì¹˜ë¥¼ ê²°ì¸¡ì¹˜ë¡œ ì„¤ì •
   ```

ì½”ë“œ ì‹¤ìŠµ
-----

### ì‹¤ìŠµ ë°ì´í„°

**Kaggle: Panama Electricity Load Forecasting**

í•´ë‹¹ ë°ì´í„°ì…‹ì€ `íŒŒë‚˜ë§ˆì˜ ì „ë ¥ ë¶€í•˜(MW)ë¥¼ ì˜ˆì¸¡`í•˜ê¸° ìœ„í•œ `ì‹œê³„ì—´ ë°ì´í„°`ì…ë‹ˆë‹¤. ë‚ ì”¨ ë³€ìˆ˜ì™€ íŠ¹ë³„í•œ ë‚ (ê³µíœ´ì¼, í•™êµ íœ´ì¼ ë“±)ì„ ì°¸ì¡°í•˜ì—¬ ì˜ˆì¸¡í•˜ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤. Kaggleì—ì„œ ì œê³µë˜ê³  ìˆìœ¼ë©°, ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì´ë¥¼ í™œìš©í•œ ì‹œê³„ì—´ ì˜ˆì¸¡ì„ ìˆ˜í–‰í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

**ë°ì´í„°ì…‹ ê°œìš”**

* **ëª©ì **: íŒŒë‚˜ë§ˆì˜ ì „ë ¥ ë¶€í•˜(MW)ë¥¼ ì˜ˆì¸¡
* **ì°¸ì¡° ë³€ìˆ˜**: ë‚ ì”¨ ë³€ìˆ˜ ë° íŠ¹ë³„í•œ ë‚ 
* **íŠ¹ì§•**: ì´ 15ê°œì˜ íŠ¹ì§•(features)ì„ í¬í•¨

**ë°ì´í„°ì…‹ êµ¬ì„±**  

1. **íŠ¹ì§•(features)**:  

- ì´ 15ê°œì˜ íŠ¹ì§•ì„ í¬í•¨  

- **12ê°œì˜ ì—°ì†ì ì¸ ìˆ˜ì¹˜í˜• ë³€ìˆ˜**: ë‚ ì”¨ ë³€ìˆ˜  

- **3ê°œì˜ íŠ¹ë³„í•œ ë‚  ê´€ë ¨ ë³€ìˆ˜**: ê³µíœ´ì¼, ê³µíœ´ì¼ ID, í•™êµ íœ´ì¼

2. **ê²°ì¸¡ì¹˜ ì—†ìŒ**: ë°ì´í„°ì…‹ì— ê²°ì¸¡ì¹˜ê°€ ì—†ìŒ
3. **ì˜ˆì¸¡ ëŒ€ìƒ**: 'nat\_demand' ì—´ì— ìˆëŠ” íŒŒë‚˜ë§ˆì˜ ì „ë ¥ ë¶€í•˜

**Column ì„¤ëª…**

* **ds**: ë‚ ì§œ ë° ì‹œê°„ (datetime)
* **T2M\_toc, QV2M\_toc, TQL\_toc, W2M\_toc**: íŠ¹ì • ì§€ì—­(toc)ì˜ ë‚ ì”¨ ë³€ìˆ˜ (ì˜¨ë„, ìŠµë„, ê°•ìˆ˜ëŸ‰, í’ì† ë“±)
* **T2M\_san, QV2M\_san, TQL\_san, W2M\_san**: ë‹¤ë¥¸ ì§€ì—­(san)ì˜ ë‚ ì”¨ ë³€ìˆ˜
* **T2M\_dav, QV2M\_dav, TQL\_dav, W2M\_dav**: ë˜ ë‹¤ë¥¸ ì§€ì—­(dav)ì˜ ë‚ ì”¨ ë³€ìˆ˜
* **Holiday\_ID**: ê³µíœ´ì¼ ID
* **holiday**: ê³µíœ´ì¼ ì—¬ë¶€ (True/False)
* **school**: í•™êµ íœ´ì¼ ì—¬ë¶€ (True/False)
* `nat_demand`: íŒŒë‚˜ë§ˆì˜ ì „ë ¥ ë¶€í•˜ (MW)

ì´ ë°ì´í„°ì…‹ì€ ë‚˜ë¨¸ì§€ ë³€ìˆ˜ë“¤ì„ í™œìš©í•˜ì—¬ `íŒŒë‚˜ë§ˆì˜ ì „ë ¥ ë¶€í•˜(net_demand)`ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ë‚ ì”¨ ë³€ìˆ˜ì™€ íŠ¹ë³„í•œ ë‚ ì„ ê³ ë ¤í•˜ì—¬ ì „ë ¥ ë¶€í•˜ë¥¼ ì˜ˆì¸¡í•¨ìœ¼ë¡œì¨, ì „ë ¥ íšŒì‚¬ëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ì „ë ¥ ê³µê¸‰ì„ ê´€ë¦¬í•˜ê³  ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°ê° trainê³¼ test y ë°ì´í„°ì˜ ì–‘ìƒì„ ì‚´í´ë³´ì‹œì£ .

**Train y**  

![](https://velog.velcdn.com/images/euisuk-chung/post/af53a59c-f72e-4a7f-bdcb-b2743a01de50/image.png)

**Test y**  

![](https://velog.velcdn.com/images/euisuk-chung/post/bdca43f5-4a60-42d1-b4cc-1a124eb88883/image.png)

![](https://velog.velcdn.com/images/euisuk-chung/post/3d5ac4f2-cbe6-4aa7-b0b1-95c821c8393c/image.png)

### ë°ì´í„° ì¤€ë¹„

Prophetì—ì„œ ìš”êµ¬í•˜ëŠ” ë°ì´í„° í˜•ì‹ì€ `ds` (datetime)ì™€ `y` (value) ì»¬ëŸ¼ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

```
import pandas as pd

# ë°ì´í„° ë¡œë“œ
train_data = pd.read_csv('./data/panama/train.csv')
test_data = pd.read_csv('./data/panama/test.csv')

# ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½
train_data.rename(columns={'datetime': 'ds', 'nat_demand': 'y'}, inplace=True)
test_data.rename(columns={'datetime': 'ds', 'nat_demand': 'y'}, inplace=True)

# ë‚ ì§œ í˜•ì‹ ë³€í™˜
train_data['ds'] = pd.to_datetime(train_data['ds'], format='%d-%m-%Y %H:%M')
test_data['ds'] = pd.to_datetime(test_data['ds'], format='%d-%m-%Y %H:%M')
```

**ì„¤ëª…:**

* `pd.read_csv`: CSV íŒŒì¼ì„ DataFrameìœ¼ë¡œ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
* `rename(columns=...)`: ì»¬ëŸ¼ ì´ë¦„ì„ ë³€ê²½í•˜ì—¬ Prophetì´ ìš”êµ¬í•˜ëŠ” í˜•ì‹ì— ë§ì¶¥ë‹ˆë‹¤.
* `pd.to_datetime`: ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/euisuk-chung/post/37174425-44ba-41cb-80ce-9a97e843a5e4/image.png)

### ëª¨ë¸ í•™ìŠµ ë° ì˜ˆì¸¡

**ëª¨ë¸ ì´ˆê¸°í™” ë° í•™ìŠµ**

```
from prophet import Prophet

# ëª¨ë¸ ì´ˆê¸°í™”
model = Prophet()

# ì¶”ê°€ ë³€ìˆ˜ (exogenous variables) ë“±ë¡
regressors = ['T2M_toc', 'QV2M_toc', 'TQL_toc', 'W2M_toc', 
              'T2M_san', 'QV2M_san', 'TQL_san', 'W2M_san', 
              'T2M_dav', 'QV2M_dav', 'TQL_dav', 'W2M_dav', 
              'Holiday_ID', 'holiday', 'school']

for regressor in regressors:
    model.add_regressor(regressor)

# ëª¨ë¸ í•™ìŠµ
model.fit(train_data)
```

**ì„¤ëª…:**

* `Prophet()`: Prophet ëª¨ë¸ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
* `add_regressor`: ëª¨ë¸ì— ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
* `fit`: ì£¼ì–´ì§„ ë°ì´í„°ë¡œ ëª¨ë¸ì„ í•™ìŠµì‹œí‚µë‹ˆë‹¤.

**ì£¼ì˜ ì‚¬í•­:**

* ì™¸ë¶€ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•  ë•Œ, í›ˆë ¨ ë°ì´í„°ì™€ ì˜ˆì¸¡ ë°ì´í„°ì— ë™ì¼í•œ ë³€ìˆ˜ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
* ì™¸ë¶€ ë³€ìˆ˜ëŠ” ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ë²”ì£¼í˜• ë³€ìˆ˜ì¼ ê²½ìš°, one-hot-encodingê³¼ ê°™ì´ ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ë³€í™˜ì„ ìˆ˜í–‰í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
* ë°ì´í„°ì˜ ì‹œê°„ í˜•ì‹ê³¼ ê°„ê²©ì„ í™•ì¸í•˜ì—¬ ì¼ê´€ë˜ê²Œ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.

**ì˜ˆì¸¡ ìˆ˜í–‰**

```
# ì˜ˆì¸¡ì„ ìœ„í•œ ë¯¸ë˜ ë°ì´í„°í”„ë ˆì„ ìƒì„± (í…ŒìŠ¤íŠ¸ ë°ì´í„°ì™€ ë™ì¼í•œ ê¸°ê°„)
future = test_data[['ds'] + regressors]

# ì˜ˆì¸¡ ìˆ˜í–‰
forecast = model.predict(future)

# ì˜ˆì¸¡ ê²°ê³¼ í™•ì¸
print(len(forecast), len(test_data)) # 744 744
```

**ì„¤ëª…:**

* `make_future_dataframe`: ì˜ˆì¸¡ì„ ìœ„í•œ ë¯¸ë˜ ë°ì´í„°í”„ë ˆì„ì„ ìƒì„±í•©ë‹ˆë‹¤.
* `predict`: ì˜ˆì¸¡ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
* `print`: ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.

### ì‹œê°í™”

Prophetì€ `Plotly ê¸°ë°˜ ì‹œê°í™” í•¨ìˆ˜`ì™€ `Matplotlib ê¸°ë°˜ ì‹œê°í™” í•¨ìˆ˜`ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

**1. ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™” (Plotly ì‚¬ìš©)**

```
from prophet.plot import plot_plotly, plot_components_plotly

# ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™” (Plotly)
fig_forecast = plot_plotly(model, forecast)
fig_forecast.show()

# ì»´í¬ë„ŒíŠ¸ ì‹œê°í™” (Plotly)
fig_components = plot_components_plotly(model, forecast)
fig_components.show()
```

**ì„¤ëª…:**

* `plot_plotly`: Plotlyë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì¸í„°ë™í‹°ë¸Œí•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, ë§ˆìš°ìŠ¤ë¡œ ê·¸ë˜í”„ë¥¼ í™•ëŒ€í•˜ê±°ë‚˜ íŠ¹ì • êµ¬ê°„ì„ ìì„¸íˆ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* `plot_components_plotly`: Plotlyë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ ê²°ê³¼ì˜ ì»´í¬ë„ŒíŠ¸(ì¶”ì„¸, ê³„ì ˆì„±, íœ´ì¼ íš¨ê³¼ ë“±)ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. ê° ì»´í¬ë„ŒíŠ¸ê°€ ì‹œê³„ì—´ ë°ì´í„°ì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ì§€ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**2. ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™” (Matplotlib ì‚¬ìš©)**

```
from prophet.plot import plot_forecast_component, add_changepoints_to_plot

# ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™” (Matplotlib)
fig1 = model.plot(forecast)
plt.show()

# ì»´í¬ë„ŒíŠ¸ ì‹œê°í™” (Matplotlib)
fig2 = model.plot_components(forecast)
plt.show()
```

**ì„¤ëª…:**

* `plot`: Matplotlibì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ Prophetì˜ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ë©°, ì‹¤ì œ ë°ì´í„°ì™€ ì˜ˆì¸¡ëœ ë°ì´í„°, ì˜ˆì¸¡ êµ¬ê°„ ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤.
* `plot_components`: Matplotlibì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ ê²°ê³¼ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. ì¶”ì„¸, ì£¼ê¸°ì„±(ê³„ì ˆì„±), íœ´ì¼ íš¨ê³¼ ë“±ì˜ ê°œë³„ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹œê°í™”í•˜ì—¬ ë°ì´í„°ì˜ ë³€ë™ ìš”ì¸ì„ ì‹œê°ì ìœ¼ë¡œ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê°€ëŠ¥ ì´ìŠˆ

> âš ï¸ **í•˜ì§€ë§Œ!** ì—¬ê¸°ì„œ `2ê°€ì§€ ë¬¸ì œì `ì„ ë§ˆì£¼í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤!!

**(1) ì²«ë²ˆì§¸**ëŠ” JupyterLabì„ ì‚¬ìš©í•˜ëŠ” ë¶„ë“¤ì˜ ê²½ìš° ë³„ë„ë¡œ Plotlyë¥¼ ì‹¤í–‰í•˜ì‹¤ ê²½ìš°, `ì‹œê°í™” ì½”ë“œëŠ” ì‹¤í–‰ì€ ë˜ì§€ë§Œ ê²°ê³¼ê°€ ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì œ`ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ëª‡ ê°€ì§€ ë°©ë²•ì„ ì œì•ˆí•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤:

1. ì£¼í”¼í„°ë© í™•ì¥ í”„ë¡œê·¸ë¨ ì„¤ì¹˜:  
   
   JupyterLabì—ì„œ Plotlyë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì¶”ê°€ í™•ì¥ í”„ë¡œê·¸ë¨ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•´ë³´ì„¸ìš”:
   
   ```
   jupyter labextension install jupyterlab-plotly
   ```
2. ë Œë”ëŸ¬ ì„¤ì •:  
   
   ë…¸íŠ¸ë¶ ì‹œì‘ ë¶€ë¶„ì— ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ë Œë”ëŸ¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•´ë³´ì„¸ìš”:
   
   ```
   import plotly.io as pio
   pio.renderers.default = "jupyterlab"
   ```
3. ì¸ë¼ì¸ ëª¨ë“œ ì‚¬ìš©:  
   
   `plotly.offline.init_notebook_mode()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë¼ì¸ ëª¨ë“œë¥¼ í™œì„±í™”í•´ë³´ì„¸ìš”:
   
   ```
   import plotly.offline as pyo
   pyo.init_notebook_mode(connected=True)
   ```
4. ëª…ì‹œì ìœ¼ë¡œ ê·¸ë˜í”„ í‘œì‹œ:  
   
   `fig.show()` ëŒ€ì‹  `display(fig)`ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”:
   
   ```
   from IPython.display import display
   display(fig)
   ```
5. ì£¼í”¼í„°ë© ì¬ì‹œì‘:  
   
   ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ì§€ ì•Šì„ ê²½ìš° ì£¼í”¼í„°ë©ì„ ì™„ì „íˆ ì¢…ë£Œí•˜ê³  ë‹¤ì‹œ ì‹œì‘í•´ë³´ì„¸ìš”.

**(2) ë‘ë²ˆì§¸**ëŠ” `Prophetì˜ plot í•¨ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì „ì²´ ì˜ˆì¸¡ ê¸°ê°„ì„ ì‹œê°í™”`í•˜ë¯€ë¡œ, í›ˆë ¨ ë°ì´í„°ì™€ ì˜ˆì¸¡ ê¸°ê°„ì´ ëª¨ë‘ í¬í•¨ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ê²°ê³¼ë¡œ ë‚˜ì˜¨ ê·¸ë˜í”„ì˜ ëª¨ì–‘ì´ ì´ì˜ì§€ ì•Šì„ í™•ë¥ ì´ ë§¤ìš°ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.

![](https://velog.velcdn.com/images/euisuk-chung/post/6e88605d-6aec-4a4c-b7e8-5b51f4cff969/image.png)

í…ŒìŠ¤íŠ¸ ê¸°ê°„ë§Œ ì‹œê°í™”í•˜ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ í•„í„°ë§í•˜ì—¬ ì›í•˜ëŠ” ê¸°ê°„ë§Œ ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* ì‹œê°í™” í‘œê¸° êµ¬ì—­ì„ `xlim`ì„ í†µí•´ ì¡°ì ˆí•˜ì—¬ ì„¤ì •í•´ì£¼ë©´ test ê²°ê³¼ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
import matplotlib.pyplot as plt
import warnings
warnings.filterwarnings('ignore')

# í…ŒìŠ¤íŠ¸ ê¸°ê°„ë§Œ í•„í„°ë§
forecast_test_period = forecast[forecast['ds'].isin(test_data['ds'])]

# ì „ì²´ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹œê°í™”
fig = model.plot(forecast)
# xì¶•ì˜ ë²”ìœ„ë¥¼ í…ŒìŠ¤íŠ¸ ê¸°ê°„ìœ¼ë¡œ ì œí•œ
plt.xlim([test_data['ds'].min(), test_data['ds'].max()])
# í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‹¤ì œê°’ ì¶”ê°€
plt.plot(test_data['ds'], test_data['y'], 'r.', label='Actual')
# ê·¸ë˜í”„ í‘œì‹œ
plt.show()

# Plotlyë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ì‹œê°í™”
fig_components = model.plot_components(forecast_test_period)
fig_components.show()
```

![](https://velog.velcdn.com/images/euisuk-chung/post/c38ae906-bc23-4f21-ba4a-f0ecf6837f1d/image.png)

**ì„¤ëª…:**

* `warnings.filterwarnings('ignore')`: ê²½ê³  ë©”ì‹œì§€ë¥¼ ë¬´ì‹œí•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
* `forecast[forecast['ds'].isin(test_data['ds'])]`: í…ŒìŠ¤íŠ¸ ë°ì´í„°ì˜ ê¸°ê°„ì— í•´ë‹¹í•˜ëŠ” ì˜ˆì¸¡ ê²°ê³¼ë¥¼ í•„í„°ë§í•©ë‹ˆë‹¤.
* `model.plot(forecast)`: Prophet ëª¨ë¸ì˜ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. ì „ì²´ ì˜ˆì¸¡ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
* `plt.xlim([test_data['ds'].min(), test_data['ds'].max()])`: xì¶•ì˜ ë²”ìœ„ë¥¼ í…ŒìŠ¤íŠ¸ ê¸°ê°„ìœ¼ë¡œ ì œí•œí•©ë‹ˆë‹¤.
* `plt.plot(test_data['ds'], test_data['y'], 'r.', label='Actual')`: í…ŒìŠ¤íŠ¸ ë°ì´í„°ì˜ ì‹¤ì œ ê°’ì„ ê·¸ë˜í”„ì— ì¶”ê°€í•©ë‹ˆë‹¤.
* `plt.show()`: ê·¸ë˜í”„ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
* `model.plot_components(forecast_test_period)`: Prophet ëª¨ë¸ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. Plotlyë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ì»´í¬ë„ŒíŠ¸(ì¶”ì„¸, ê³„ì ˆì„±, íœ´ì¼ íš¨ê³¼ ë“±)ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.
* ì•„ë‹ˆë©´ ê·¸ëƒ¥ ë§ˆìŒ í¸í•˜ê²Œ ì§ì ‘ ì‹œê°í™” ê²°ê³¼ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.

```
import matplotlib.pyplot as plt
from sklearn.metrics import mean_squared_error

# ì‹¤ì œê°’ê³¼ ì˜ˆì¸¡ê°’ ë³‘í•©
result = test_data.copy()
result['yhat'] = forecast.set_index('ds').loc[test_data['ds']]['yhat'].values

# ì˜ˆì¸¡ ê²°ê³¼ ì‹œê°í™”
plt.figure(figsize=(20, 4))
plt.plot(result['ds'], result['y'], label='Actual')
plt.plot(result['ds'], result['yhat'], label='Predicted', linestyle='dashed')
plt.fill_between(forecast['ds'], forecast['yhat_lower'], forecast['yhat_upper'], color='gray', alpha=0.2)
plt.legend()
plt.show()
```

![](https://velog.velcdn.com/images/euisuk-chung/post/7916d053-cd1d-4bc9-9f99-c8679eed390f/image.png)

**ì„¤ëª…:**

* `test_data.copy()`: í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ì—¬ `result` ë°ì´í„°í”„ë ˆì„ì„ ìƒì„±í•©ë‹ˆë‹¤.
* `forecast.set_index('ds').loc[test_data['ds']]['yhat'].values`: ì˜ˆì¸¡ ê²°ê³¼ì—ì„œ í…ŒìŠ¤íŠ¸ ê¸°ê°„ì— í•´ë‹¹í•˜ëŠ” ì˜ˆì¸¡ ê°’ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
* `result['yhat'] = ...`: ì¶”ì¶œí•œ ì˜ˆì¸¡ ê°’ì„ `result` ë°ì´í„°í”„ë ˆì„ì— ì¶”ê°€í•©ë‹ˆë‹¤.
* `plt.figure(figsize=(20, 4))`: ê·¸ë˜í”„ì˜ í¬ê¸°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
* `plt.plot(result['ds'], result['y'], label='Actual')`: í…ŒìŠ¤íŠ¸ ë°ì´í„°ì˜ ì‹¤ì œ ê°’ì„ ê·¸ë˜í”„ì— ì¶”ê°€í•©ë‹ˆë‹¤.
* `plt.plot(result['ds'], result['yhat'], label='Predicted', linestyle='dashed')`: ì˜ˆì¸¡ ê°’ì„ ê·¸ë˜í”„ì— ì¶”ê°€í•©ë‹ˆë‹¤.
* `plt.fill_between(forecast['ds'], forecast['yhat_lower'], forecast['yhat_upper'], color='gray', alpha=0.2)`: ì˜ˆì¸¡ ê°’ì˜ ë¶ˆí™•ì‹¤ì„± êµ¬ê°„ì„ íšŒìƒ‰ ìŒì˜ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
* `plt.legend()`: ë²”ë¡€ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
* `plt.show()`: ê·¸ë˜í”„ë¥¼ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.

### ì„±ëŠ¥ í‰ê°€

ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹¤ì œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì™€ ë¹„êµí•˜ì—¬ ì„±ëŠ¥ì„ ê²€ì¦í•©ë‹ˆë‹¤.

```
from sklearn.metrics import mean_squared_error

# ì‹¤ì œê°’ê³¼ ì˜ˆì¸¡ê°’ ë³‘í•©
result = test_data.copy()
result['yhat'] = forecast.set_index('ds').loc[test_data['ds']]['yhat'].values

# ì„±ëŠ¥ í‰ê°€ (MSE)
mse = mean_squared_error(result['y'], result['yhat'])
print(f'Mean Squared Error: {mse}')
```
#### ì„¤ëª…:

* `mean_squared_error`: ì‹¤ì œê°’ê³¼ ì˜ˆì¸¡ê°’ì˜ í‰ê·  ì œê³± ì˜¤ì°¨ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
* `copy`: ë°ì´í„°í”„ë ˆì„ì„ ë³µì‚¬í•©ë‹ˆë‹¤.
* `set_index`: ë°ì´í„°í”„ë ˆì„ì˜ ì¸ë±ìŠ¤ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
* `loc`: íŠ¹ì • í–‰ì„ ì„ íƒí•©ë‹ˆë‹¤.

ìš”ì•½
--

ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Prophetì— ëŒ€í•œ ì†Œê°œì™€ ì´ë¥¼ í™œìš©í•œ ì‹œê³„ì—´ ì˜ˆì¸¡ì„ ìˆ˜í–‰í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

1. **ë°ì´í„° ì¤€ë¹„**: Prophetì—ì„œ ìš”êµ¬í•˜ëŠ” í˜•ì‹ì— ë§ì¶° ë°ì´í„°ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.
2. **ëª¨ë¸ ì´ˆê¸°í™” ë° í•™ìŠµ**: Prophet ëª¨ë¸ì„ ì´ˆê¸°í™”í•˜ê³  í•™ìŠµ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ì„ í•™ìŠµì‹œí‚µë‹ˆë‹¤.
3. **ì˜ˆì¸¡ ìˆ˜í–‰**: ë¯¸ë˜ ë°ì´í„°í”„ë ˆì„ì„ ìƒì„±í•˜ê³  ì˜ˆì¸¡ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
4. **ì‹œê°í™”**: Prophetì˜ ë‚´ì¥ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ ê²°ê³¼ì™€ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.
5. **ì„±ëŠ¥ í‰ê°€**: ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ì‹¤ì œ ë°ì´í„°ì™€ ë¹„êµí•˜ì—¬ ì„±ëŠ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.

ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ â­

