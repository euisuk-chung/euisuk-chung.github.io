---
title: "[Linux] 열려 있는 파일 및 리소스 관리의 필수 도구(lsof)"
date: "2024-01-17"
tags:
  - "linux"
  - "환경"
year: "2024"
---

# [Linux] 열려 있는 파일 및 리소스 관리의 필수 도구(lsof)

원본 게시글: https://velog.io/@euisuk-chung/uqqb19in



Linux `lsof` 명령어
================

리눅스 시스템에서 파일이나 디렉토리를 삭제하려고 할 때 "**디렉토리가 비어 있지 않다**"는 오류를 마주친 경험이 있을 겁니다. 이는 대개 해당 디렉토리 내의 파일들이 여전히 어떤 프로세스에 의해 사용되고 있기 때문에 발생합니다.

* 이 글에서는 `lsof` 명령어를 사용하여 이러한 문제를 어떻게 해결할 수 있는지 알아보겠습니다.

---

`lsof`란 무엇인가?
-------------

**열려 있는 파일 및 리소스 관리의 필수 도구**

`lsof`는 "List Open Files"의 약자로, 현재 시스템에서 열려 있는 파일들의 목록을 보여주는 강력한 유닉스 명령어입니다. 시스템 관리자와 일반 사용자 모두에게 필수적인 이 명령어는 파일을 열고 있는 프로세스의 PID(프로세스 식별 번호), 사용자, 파일 이름, 네트워크 소켓 정보 등 다양한 정보를 제공합니다.

### `lsof` 설치 방법

대부분의 리눅스 배포판에는 `lsof`가 미리 설치되어 있지만, 설치가 필요할 경우 아래 명령어를 사용하여 설치할 수 있습니다.

* **Debian, Ubuntu 및 기타 유사한 시스템:**
  
  ```
  sudo apt install lsof
  ```
* **Red Hat, CentOS 및 기타 유사한 시스템:**
  
  ```
  sudo yum install lsof
  ```
* **Fedora 시스템:**
  
  ```
  sudo dnf install lsof
  ```

설치가 완료되면, `lsof` 명령어를 시스템의 어느 위치에서나 사용할 수 있습니다.

---

`lsof`가 필요한 이유
--------------

리눅스 파일 시스템에서 파일이 삭제되거나 이동되지 않는 문제는 해당 파일이 다른 프로세스에 의해 사용 중일 때 자주 발생합니다. `lsof`를 사용하면 파일이나 디렉토리를 현재 사용 중인 프로세스를 쉽게 식별할 수 있습니다. 이를 통해 시스템의 특정 리소스가 점유된 상태를 확인하고, 필요한 경우 프로세스를 종료하거나 관리할 수 있어 시스템 안정성과 리소스 관리를 개선할 수 있습니다.

---

`lsof`의 주요 사용 예제
----------------

### 1. 특정 디렉토리를 사용 중인 프로세스 찾기

디렉토리 내부에서 열려 있는 모든 파일을 열고 있는 프로세스를 확인할 수 있습니다. 특히, 디렉토리가 비어 있지 않다는 오류가 발생할 때 유용합니다.

```
lsof +D /path/to/directory
```

**예시:**

```
lsof +D /home/user/logs
```

이 명령어는 `/home/user/logs` 디렉토리 내의 모든 열려 있는 파일을 찾고, 이를 사용 중인 프로세스 목록을 보여줍니다.

#### 프로세스 강제 종료

출력된 결과에서 해당 PID를 확인한 후, 다음 명령어로 프로세스를 강제 종료할 수 있습니다.

```
kill -9 PID
```
> ⚠️ **주의:** `kill -9`는 강제 종료 신호이므로 데이터 손실을 방지하기 위해 가능하다면 일반적인 종료 옵션(`kill PID`)을 사용하는 것이 좋습니다.

---

### 2. 특정 파일을 열고 있는 프로세스 찾기

파일 단위로 열려 있는 프로세스를 찾고 싶다면 파일 경로를 직접 지정할 수 있습니다.

```
lsof /path/to/file
```

**예시:**

```
lsof /var/log/syslog
```

이 명령어는 `/var/log/syslog` 파일을 열고 있는 프로세스를 표시하여 로그 파일을 점유한 프로세스를 빠르게 찾을 수 있습니다.

---

### 3. 특정 포트를 점유하고 있는 프로세스 찾기

네트워크 관리에서 특정 포트를 사용 중인 프로세스를 확인하고 싶을 때 유용합니다. 예를 들어, 80번 포트를 점유 중인 프로세스를 찾으려면 다음과 같이 입력합니다.

```
lsof -i :80
```

이 명령어는 웹 서버 등 네트워크 포트 사용 상황을 확인하고 관리하는 데 유용합니다.

---

### 4. 특정 사용자에 의해 열린 파일 목록 조회

특정 사용자가 열어 놓은 파일을 확인하려면 `-u` 옵션을 사용합니다.

```
lsof -u [사용자 이름]
```

**예시:**

```
lsof -u username
```

이 명령어는 해당 사용자가 현재 열어 놓은 모든 파일과 관련된 프로세스를 나열합니다.

---

### 5. 모든 네트워크 연결 확인

네트워크 관련 문제 해결 시 시스템의 전체 네트워크 연결 상태를 확인하려면 `-i` 옵션을 사용합니다.

```
lsof -i
```

이 명령어는 TCP 및 UDP 연결 정보를 포함해 시스템의 모든 네트워크 소켓 상태를 표시합니다.

---

### 6. 특정 프로세스 ID(PID)에 의해 열려 있는 파일 확인

특정 PID가 열고 있는 파일을 확인하려면 `-p` 옵션을 사용합니다. 이는 특정 프로세스가 사용 중인 파일들을 빠르게 확인할 때 유용합니다.

```
lsof -p [PID]
```

**예시:**

```
lsof -p 1234
```

---

### 7. `lsof`를 사용한 실시간 파일 사용 추적

시스템 성능 저하나 특정 리소스의 사용 현황을 실시간으로 추적하고 싶다면 `watch` 명령어와 결합하여 사용할 수 있습니다. 예를 들어, `/var/log` 디렉토리를 2초 간격으로 모니터링하려면 다음 명령어를 입력합니다.

```
watch -n 2 'lsof +D /var/log'
```

이 명령은 `lsof` 명령의 결과를 주기적으로 업데이트하여, 로그 디렉토리에 열려 있는 파일 목록을 실시간으로 확인할 수 있게 합니다.

---

`lsof` 사용 시 유의 사항
-----------------

* **강제 종료 주의**: `kill -9` 옵션으로 프로세스를 종료할 때는 데이터 손실이나 작업 중단이 발생할 수 있으므로, 항상 대체 종료 옵션을 먼저 고려해야 합니다.
* **특정 권한 필요**: `lsof`는 루트 권한이 필요할 수 있으므로, 충분한 권한을 가지고 실행하는 것이 좋습니다.
* **대규모 시스템에서 성능 문제 가능**: 대규모 파일 시스템이나 많은 프로세스를 다룰 때는 `lsof` 명령이 다소 느릴 수 있습니다. 특정 경로나 PID를 지정하여 사용 범위를 제한하는 것이 효율적입니다.

---

결론
--

`lsof`는 시스템의 파일 및 리소스 사용 현황을 진단하는 데 매우 유용한 도구로, 리소스 점유 문제를 신속하게 해결할 수 있습니다. 이 글을 통해 `lsof`의 기본적인 사용 방법과 다양한 활용 사례를 이해하고, 시스템 관리와 문제 해결에 적극적으로 활용해 보시기 바랍니다.

